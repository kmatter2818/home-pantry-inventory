<!DOCTYPE html>
<html>
<head>
  <title>My Pantry Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }

    h1, h2 {
      text-align: center;
    }

    input, select {
      padding: 6px;
      margin: 4px;
      font-size: 1rem;
    }

    button {
      padding: 6px 10px;
      margin: 4px;
      font-size: 0.9rem;
      border-radius: 4px;
      cursor: pointer;
    }

    ul {
      padding-left: 0;
    }

    li {
      list-style: none;
      border-bottom: 1px solid #ccc;
      padding: 6px 0;
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .info {
      flex: 1;
    }

    .done {
      text-decoration: line-through;
      color: gray;
    }

    /* mild responsiveness */
    @media (max-width: 600px) {
      li {
        gap: 4px;
      }
      button {
        padding: 4px 6px;
        font-size: 0.8rem;
      }
    }
  </style>
</head>

<body>
  <h1>My Pantry Tracker</h1>

  <h2>Add Item</h2>

  <input id="itemInput" type="text" placeholder="Item">
  <input id="qtyInput" type="number" placeholder="Qty" min="1">
  <select id="catInput">
    <option value="">Category</option>
    <option>Dairy</option>
    <option>Produce</option>
    <option>Meat</option>
    <option>Canned</option>
    <option>Bread</option>
  </select>
  <input id="expInput" type="date">
  <button onclick="addItem()">Add</button>

  <br>
  <button onclick="sortAlpha()">Sort A→Z</button>
  <button onclick="sortCat()">Sort by Category</button>

  <br>
  <input id="searchInput" placeholder="Search..." oninput="render()">


  <h2>Shopping List</h2>
  <ul id="shoppingList"></ul>

  <h2>Pantry</h2>
  <ul id="pantryList"></ul>


<script>
  // ===== CONFIG =====
  const API_BASE = "https://pantry-api-74qw.onrender.com";   // cloud backend
  const HOUSEHOLD_KEY = "home";   // shared group id

  let items = [];

  function toPayload(x) {
    return {
      household: HOUSEHOLD_KEY,
      name: x.name,
      qty: x.qty,
      cat: x.cat || "",
      exp: x.exp || null,
      done: !!x.done,
      location: x.location
    };
  }

  async function apiGet() {
    const res = await fetch(`${API_BASE}/items?household=${encodeURIComponent(HOUSEHOLD_KEY)}`);
    if (!res.ok) throw new Error("GET failed");
    return await res.json();
  }

  async function apiCreate(x) {
    const res = await fetch(`${API_BASE}/items`, {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify(toPayload(x))
    });
    if (!res.ok) throw new Error("POST failed");
    return await res.json();
  }

  async function apiUpdate(x) {
    const res = await fetch(`${API_BASE}/items/${x.id}`, {
      method: "PUT",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify(toPayload(x))
    });
    if (!res.ok) throw new Error("PUT failed");
    return await res.json();
  }

  async function apiDelete(id) {
    const res = await fetch(
      `${API_BASE}/items/${id}?household=${encodeURIComponent(HOUSEHOLD_KEY)}`,
      { method: "DELETE" }
    );
    if (!res.ok) throw new Error("DELETE failed");
    return await res.json();
  }

  async function loadItems() {
    try {
      items = await apiGet();
      localStorage.setItem("cache_items", JSON.stringify(items));
    } catch (e) {
      items = JSON.parse(localStorage.getItem("cache_items") || "[]");
    }
    render();
  }

  async function addItem() {
    const name = document.getElementById('itemInput').value.trim();
    const qty  = document.getElementById('qtyInput').value.trim();
    const cat  = document.getElementById('catInput').value.trim();
    const exp  = document.getElementById('expInput').value.trim();

    if (!name || !qty) return;

    const created = await apiCreate({ name, qty, cat, exp, done:false, location:"shopping" });
    items.push(created);
    localStorage.setItem("cache_items", JSON.stringify(items));
    clearForm();
    render();
  }

  function clearForm() {
    document.getElementById('itemInput').value = "";
    document.getElementById('qtyInput').value = "";
    document.getElementById('catInput').value = "";
    document.getElementById('expInput').value = "";
  }

  async function toggleDone(idx) {
    const x = items[idx];
    x.done = !x.done;
    const updated = await apiUpdate(x);
    items[idx] = updated;
    localStorage.setItem("cache_items", JSON.stringify(items));
    render();
  }

  async function moveItem(idx) {
    const x = items[idx];
    x.location = (x.location === "shopping") ? "pantry" : "shopping";
    const updated = await apiUpdate(x);
    items[idx] = updated;
    localStorage.setItem("cache_items", JSON.stringify(items));
    render();
  }

  async function editItem(idx) {
    const x = items[idx];
    const name = prompt("Name:", x.name);
    if (name === null) return;
    const qty  = prompt("Qty:", x.qty);
    if (qty === null) return;
    const cat  = prompt("Category:", x.cat || "");
    if (cat === null) return;
    const exp  = prompt("Expiration (YYYY-MM-DD):", x.exp || "");
    if (exp === null) return;

    Object.assign(x, { name, qty, cat, exp });
    const updated = await apiUpdate(x);
    items[idx] = updated;
    localStorage.setItem("cache_items", JSON.stringify(items));
    render();
  }

  async function deleteItem(idx) {
    const id = items[idx].id;
    await apiDelete(id);
    items.splice(idx, 1);
    localStorage.setItem("cache_items", JSON.stringify(items));
    render();
  }

  function sortAlpha() {
    items.sort((a, b) => a.name.localeCompare(b.name));
    render();
  }

  function sortCat() {
    items.sort((a, b) => (a.cat || "").localeCompare(b.cat || ""));
    render();
  }

  function render() {
    const sUL = document.getElementById('shoppingList');
    const pUL = document.getElementById('pantryList');
    const search = (document.getElementById('searchInput')?.value || "").toLowerCase();

    sUL.innerHTML = '';
    pUL.innerHTML = '';

    items.forEach((item, index) => {
      if (search && !item.name.toLowerCase().includes(search)) return;

      const li = document.createElement('li');

      const chk = document.createElement('input');
      chk.type = "checkbox";
      chk.checked = item.done;
      chk.onchange = () => toggleDone(index);

      const info = document.createElement('div');
      info.className = "info";
      const expText = item.exp ? ` — ${item.exp}` : "";
      info.textContent = `${item.name} — ${item.qty} — ${item.cat || ""}${expText}`;
      if (item.done) info.classList.add("done");

      const moveBtn = document.createElement('button');
      moveBtn.textContent = (item.location === "shopping") ? "➡ Pantry" : "⬅ Shopping";
      moveBtn.onclick = () => moveItem(index);

      const editBtn = document.createElement('button');
      editBtn.textContent = "Edit";
      editBtn.onclick = () => editItem(index);

      const delBtn = document.createElement('button');
      delBtn.textContent = "X";
      delBtn.onclick = () => deleteItem(index);

      li.appendChild(chk);
      li.appendChild(info);
      li.appendChild(moveBtn);
      li.appendChild(editBtn);
      li.appendChild(delBtn);

      if (item.location === "shopping") {
        sUL.appendChild(li);
      } else {
        pUL.appendChild(li);
      }
    });
  }

  window.addEventListener('load', loadItems);
</script>

</body>
</html>






