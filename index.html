<!DOCTYPE html>
<html>
<head>
  <title>My Pantry Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- âœ… PWA manifest -->
  <link rel="manifest" href="./manifest.json">

  <style>
    :root {
      --bg: #ffffff;
      --text: #000000;
      --border: #cccccc;
      --item-bg: #ffffff;
      --button-bg: #f0f0f0;
      --button-text: #000000;
    }

    .dark {
      --bg: #1e1e1e;
      --text: #e8e8e8;
      --border: #555;
      --item-bg: #2a2a2a;
      --button-bg: #333;
      --button-text: #e8e8e8;
    }

    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
      background: var(--bg);
      color: var(--text);
      transition: background 0.3s, color 0.3s;
    }

    h1, h2 {
      text-align: center;
    }

    input, select {
      padding: 6px;
      margin: 4px;
      font-size: 1rem;
      background: var(--item-bg);
      color: var(--text);
      border: 1px solid var(--border);
    }

    button {
      padding: 6px 10px;
      margin: 4px;
      font-size: 0.9rem;
      border-radius: 4px;
      cursor: pointer;
      background: var(--button-bg);
      color: var(--button-text);
      border: 1px solid var(--border);
    }

    ul {
      padding-left: 0;
    }

    li {
      list-style: none;
      border-bottom: 1px solid var(--border);
      padding: 6px 0;
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      background: var(--item-bg);
    }

    .info {
      flex: 1;
    }

    .done {
      text-decoration: line-through;
      color: gray;
    }

    @media (max-width: 600px) {
      li {
        gap: 4px;
      }
      button {
        padding: 4px 6px;
        font-size: 0.8rem;
      }
    }
  </style>
</head>

<body>
  <button onclick="toggleTheme()" style="float:right;">ðŸŒ“ Theme</button>
  <h1>My Pantry Tracker</h1>

  <h2>Add Item</h2>

  <input id="itemInput" type="text" placeholder="Item">
  <input id="qtyInput" type="number" placeholder="Qty" min="1">
  <select id="catInput">
    <option value="">Category</option>
    <option>Dairy</option>
    <option>Produce</option>
    <option>Meat</option>
    <option>Canned</option>
    <option>Bread</option>
  </select>

  <button onclick="addItem()">Add</button>

  <br>
  <button onclick="sortAlpha()">Sort Aâ†’Z</button>
  <button onclick="sortCat()">Sort by Category</button>

  <br>
  <input id="searchInput" placeholder="Search..." oninput="render()">

  <h2>Shopping List</h2>
  <ul id="shoppingList"></ul>

  <h2>Pantry</h2>
  <ul id="pantryList"></ul>


<script>
  /* =======================
      API CONFIG
  ======================== */
  const API_BASE = "https://pantry-api-74qw.onrender.com";
  const HOUSEHOLD_KEY = "home";

  let items = [];


  /* =======================
      THEME
  ======================== */
  function applyTheme(theme) {
    if (theme === "dark") {
      document.body.classList.add("dark");
    } else {
      document.body.classList.remove("dark");
    }
  }

  function toggleTheme() {
    const curr = localStorage.getItem("theme") || "light";
    const next = curr === "light" ? "dark" : "light";
    localStorage.setItem("theme", next);
    applyTheme(next);
  }

  applyTheme(localStorage.getItem("theme") || "light");


  /* =======================
      API HELPERS
  ======================== */
  function toPayload(x) {
    return {
      household: HOUSEHOLD_KEY,
      name: x.name,
      qty: x.qty,
      cat: x.cat || "",
      exp: x.exp || null,
      done: !!x.done,
      location: x.location
    };
  }

  async function apiGet() {
    const res = await fetch(`${API_BASE}/items?household=${encodeURIComponent(HOUSEHOLD_KEY)}`);
    return await res.json();
  }

  async function apiCreate(x) {
    const res = await fetch(`${API_BASE}/items`, {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify(toPayload(x))
    });
    return await res.json();
  }

  async function apiUpdate(x) {
    const res = await fetch(`${API_BASE}/items/${x.id}`, {
      method: "PUT",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify(toPayload(x))
    });
    return await res.json();
  }

  async function apiDelete(id) {
    const res = await fetch(
      `${API_BASE}/items/${id}?household=${encodeURIComponent(HOUSEHOLD_KEY)}`,
      { method: "DELETE" }
    );
    return await res.json();
  }


  /* =======================
      LOAD
  ======================== */
  async function loadItems() {
    try {
      items = await apiGet();
      localStorage.setItem("cache_items", JSON.stringify(items));
    } catch {
      items = JSON.parse(localStorage.getItem("cache_items") || "[]");
    }
    render();
  }


  /* =======================
      ACTIONS
  ======================== */
  async function addItem() {
    const name = itemInput.value.trim();
    const qty  = qtyInput.value.trim();
    const cat  = catInput.value.trim();

    if (!name || !qty) return;

    const created = await apiCreate({ name, qty, cat, exp:null, done:false, location:"shopping" });
    items.push(created);
    localStorage.setItem("cache_items", JSON.stringify(items));
    clearForm();
    render();
  }

  function clearForm() {
    itemInput.value = "";
    qtyInput.value = "";
    catInput.value = "";
  }

  async function toggleDone(idx) {
    const x = items[idx];
    x.done = !x.done;
    const updated = await apiUpdate(x);
    items[idx] = updated;
    localStorage.setItem("cache_items", JSON.stringify(items));
    render();
  }

  async function moveItem(idx) {
    const x = items[idx];
    x.location = (x.location === "shopping") ? "pantry" : "shopping";
    const updated = await apiUpdate(x);
    items[idx] = updated;
    localStorage.setItem("cache_items", JSON.stringify(items));
    render();
  }

  async function editItem(idx) {
    const x = items[idx];
    const name = prompt("Name:", x.name);
    if (name === null) return;

    const qty  = prompt("Qty:", x.qty);
    if (qty === null) return;

    const cat  = prompt("Category:", x.cat || "");
    if (cat === null) return;

    const exp  = prompt("Expiration (YYYY-MM-DD):", x.exp || "");
    if (exp === null) return;

    Object.assign(x, { name, qty, cat, exp });
    const updated = await apiUpdate(x);
    items[idx] = updated;
    localStorage.setItem("cache_items", JSON.stringify(items));
    render();
  }

  async function deleteItem(idx) {
    const id = items[idx].id;
    await apiDelete(id);
    items.splice(idx, 1);
    localStorage.setItem("cache_items", JSON.stringify(items));
    render();
  }

  function sortAlpha() {
    items.sort((a, b) => a.name.localeCompare(b.name));
    render();
  }

  function sortCat() {
    items.sort((a, b) => (a.cat || "").localeCompare(b.cat || ""));
    render();
  }


  /* =======================
      RENDER
  ======================== */
  function render() {
    shoppingList.innerHTML = "";
    pantryList.innerHTML = "";
    const filter = searchInput.value?.toLowerCase() ?? "";

    items.forEach((item, index) => {
      if (filter && !item.name.toLowerCase().includes(filter)) return;

      const li = document.createElement("li");

      const chk = document.createElement("input");
      chk.type = "checkbox";
      chk.checked = item.done;
      chk.onchange = () => toggleDone(index);

      const info = document.createElement("div");
      info.className = "info";
      const expText = item.exp ? ` â€” ${item.exp}` : "";
      info.textContent = `${item.name} â€” ${item.qty} â€” ${item.cat || ""}${expText}`;
      if (item.done) info.classList.add("done");

      const moveBtn = document.createElement("button");
      moveBtn.textContent = item.location === "shopping" ? "âž¡ Pantry" : "â¬… Shopping";
      moveBtn.onclick = () => moveItem(index);

      const editBtn = document.createElement("button");
      editBtn.textContent = "Edit";
      editBtn.onclick = () => editItem(index);

      const delBtn = document.createElement("button");
      delBtn.textContent = "X";
      delBtn.onclick = () => deleteItem(index);

      li.appendChild(chk);
      li.appendChild(info);
      li.appendChild(moveBtn);
      li.appendChild(editBtn);
      li.appendChild(delBtn);

      if (item.location === "shopping") {
        shoppingList.appendChild(li);
      } else {
        pantryList.appendChild(li);
      }
    });
  }

  window.addEventListener("load", loadItems);
</script>


<!-- âœ… Register service worker -->
<script>
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker
        .register("./service-worker.js")
        .then(() => console.log("âœ… Service Worker Registered"))
        .catch(err => console.log("SW reg failed:", err));
    });
  }
</script>

</body>
</html>









